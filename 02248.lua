------------------------------------------------------------------------------
--檢驗主副職等級(主職,副職)
function DW_EliteSkill_CheckLv(Main_Voc,Sub_Voc)
	local Obj = OwnerID()
	local Main_Lv = voc_lv(Main_Voc,Obj)
	local Sub_Lv = voc_lv(Sub_Voc,Obj)
	local TopLv = 50
	for i=3,(TopLv/5),1 do
		if	Main_Lv < i*5	or
			Sub_Lv < i*5	then
			return i*5
		end
	end
	return 10000--回傳一個超大值 代表等級俱滿
end
------------------------------------------------------------------------------
--檢驗重要物品進度(主職,副職)
function DW_EliteSkill_CheckProgress(Main_Voc,Sub_Voc)
	local Obj = OwnerID()
	local TopLv = 50
	local Temp
	for i=3,(TopLv/5),1 do
		Temp = DW_EliteSkill_KeyItemSearch(  (i*5)  ,Main_Voc,Sub_Voc)
		if	CheckFlag(Obj,Temp)==false	then
			return i*5
		end
	end
	return 10000 --回傳一個超大值 代表已經學完全部
end
------------------------------------------------------------------------------
--取得菁英技能的重要物品(輸入想取得的等級)
function DW_EliteSkill_Get(Lv,BackDoor)
	local Obj = OwnerID()
	local Main_Voc = ReadRoleValue(Obj,EM_RoleValue_VOC)
	local Sub_Voc = ReadRoleValue(Obj,EM_RoleValue_VOC_SUB)

	local KeyItemID = DW_EliteSkill_KeyItemSearch(Lv,Main_Voc,Sub_Voc)
	SetFlag(Obj,KeyItemID,1) --開啟技能

	if	BackDoor~=nil	then
		KeyItemID = DW_EliteSkill_KeyItemSearch(Lv,Sub_Voc,Main_Voc)--同時取得另一邊的技能
		SetFlag(Obj,KeyItemID,1) --開啟技能
	end
end
------------------------------------------------------------------------------
--查詢對應的菁英技能證書物品編號
function DW_EliteSkill_ItemNum(Level)
	local Array = {
			[15]=202949,
			[20]=202950,
			[25]=209075,
			[30]=202957,
			[35]=209076,
			[40]=202964,
			[45]=202965,
			[50]=202966,
			}
	return Array[Level]
end
------------------------------------------------------------------------------
--查詢是否有特定階級的舊證書
function DW_EliteSkill_SPLvItemSearch(Level)
	local Obj = OwnerID()
	local Book25 = {202951,202952,202953,202954,202955,202956,206126,206127}
	local Book35 = {202958,202959,202960,202961,202962,202963,206433,206434}
	if	Level~=25	or
		Level~=35	then
		return false
	elseif	Level==25	then
		for i=1,table.getn(Book25),1 do
			if	CountBodyItem(Obj,Book25[i])>0	then
				return true
			end
		end
	elseif	Level==35	then
		for i=1,table.getn(Book35),1 do
			if	CountBodyItem(Obj,Book35[i])>0	then
				return true
			end
		end
	end
	return false
end
------------------------------------------------------------------------------
--查詢對應的菁英技能重要物品
function DW_EliteSkill_KeyItemSearch(Level,Main_Voc,Sub_Voc)
	local LvScale = (Level/5)-2;
	local VocationSkill = {

				[1]={
					[2]={541885,541915,541945,541975,542006,542036,542066,542096},
					[3]={541886,541916,541946,541976,542007,542037,542067,542097},
					[4]={541887,541917,541947,541977,542008,542038,542068,542098},
					[5]={541888,541918,541948,541978,542009,542039,542069,542099},
					[6]={541889,541919,541949,541979,542010,542040,542070,542100},
					[7]={543016,543024,543032,543040,543048,543056,543064,543072},
					[8]={543017,543025,543033,543041,543049,543057,543065,543073},
					[9]={545960,545961,545962,545963,545964,545965,545966,545967},
					[10]={545968,545969,545970,545971,545972,545973,545974,545975}
				},


				[2]={
					[1]={541890,541920,541950,541980,542011,542041,542071,542101},
					[3]={541891,541921,541951,541981,542012,542042,542072,542102},
					[4]={541892,541922,541952,541982,542013,542043,542073,542103},
					[5]={541893,541923,541953,541983,542014,542044,542074,542104},
					[6]={541894,541924,541954,541984,542015,542045,542075,542105},
					[7]={543018,543026,543034,543042,543050,543058,543066,543074},
					[8]={543019,543027,543035,543043,543051,543059,543067,543075}
				},

				[3]={
					[1]={541895,541925,541955,541985,542016,542046,542076,542106},
					[2]={541896,541926,541956,541986,542017,542047,542077,542107},
					[4]={541897,541927,541957,541987,542018,542048,542078,542108},
					[5]={541898,541928,541958,541988,542019,542049,542079,542109},
					[6]={541899,541929,541959,541989,542020,542050,542080,542110},
					[7]={543020,543028,543036,543044,543052,543060,543068,543076},
					[8]={543021,543029,543037,543045,543053,543061,543069,543077},
					[9]={545976,545977,545978,545979,545980,545981,545982,545983},
					[10]={545984,545985,545986,545987,545988,545989,545990,545991}
				},

				[4] = {
					[1]={541900,541930,541960,541990,542021,542051,542081,542111},
					[2]={541901,541931,541961,541991,542022,542052,542082,542112},
					[3]={541902,541932,541962,541992,542023,542053,542083,542113},
					[5] ={541903,541933,541963,541993,542024,542054,542084,542114},
					[6]={541904,541934,541964,541994,542025,542055,542085,542115},
					[7]={543022,543030,543038,543046,543054,543062,543070,543078},
					[8]={543023,543031,543039,543047,543055,543063,543071,543079},
					[9]={545992,545993,545994,545995,545996,545997,545998,545999},
					[10]={546015,546016,546017,546018,546019,546020,546021,546022}
				},
				[5] = {
					[1]={541905,541935,541965,541995,542026,542056,542086,542116},
					[2]={541906,541936,541966,541996,542027,542057,542087,542117},
					[3]={541907,541937,541967,541997,542028,542058,542088,542118},
					[4]={541908,541938,541968,541998,542029,542059,542089,542119},
					[6]={541909,541939,541969,541999,542030,542060,542090,542120},
					[9]={546023,546024,546025,546026,546027,546028,546029,546030},
					[10]={546031,546032,546033,546034,546035,546036,546037,546038}
				},


				[6]={
					[1]={541910,541940,541970,542001,542031,542061,542091,542121},
					[2]={541911,541941,541971,542002,542032,542062,542092,542122},
					[3]={541912,541942,541972,542003,542033,542063,542093,542123},
					[4]={541913,541943,541973,542004,542034,542064,542094,542124},
					[5]={541914,541944,541974,542005,542035,542065,542095,542125}
				},

				[7]={
					[1]={543080,543090,543100,543110,543120,543130,543140,543150},
					[2]={543081,543091,543101,543111,543121,543131,543141,543151},
					[3]={543082,543092,543102,543112,543122,543132,543142,543152},
					[4]={543083,543093,543103,543113,543123,543133,543143,543153},
					[8]={543084,543094,543104,543114,543124,543134,543144,543154}
				},


				[8]={
					[1]={543085,543095,543105,543115,543125,543135,543145,543155},
					[2]={543086,543096,543106,543116,543126,543136,543146,543156},
					[3]={543087,543097,543107,543117,543127,543137,543147,543157},
					[4]={543088,543098,543108,543118,543128,543138,543148,543158},
					[7]={543089,543099,543109,543119,543129,543139,543149,543159}
				},

				[9]={
					[1]={545880,545881,545882,545883,545884,545885,545886,545887},
					[3]={545888,545889,545890,545891,545892,545893,545894,545895},
					[4]={545896,545897,545898,545899,545900,545901,545902,545903},
					[5]={545904,545905,545906,545907,545908,545909,545910,545911},
					[10]={545912,545913,545914,545915,545916,545917,545918,545919}
				},


				[10]={
					[1]={545920,545921,545922,545923,545924,545925,545926,545927},
					[3]={545928,545929,545930,545931,545932,545933,545934,545935},
					[4]={545936,545937,545938,545939,545940,545941,545942,545943},
					[5]={545944,545945,545946,545947,545948,545949,545950,545951},
					[9]={545952,545953,545954,545955,545956,545957,545958,545959}
				}

																		}
	return VocationSkill[Main_Voc][Sub_Voc][LvScale]
end
function DW_EliteSkill_tBackDoor()
	local Player=OwnerID();
	local Main_Voc = ReadRoleValue(Player,EM_RoleValue_VOC)
	local Sub_Voc = ReadRoleValue(Player,EM_RoleValue_VOC_SUB)
	if Sub_Voc<=0 then
		return false;
	end
	local MainLv=voc_lv(Main_Voc,Player);
	local SubLv=voc_lv(Sub_Voc,Player);
	if MainLv>=60 and SubLv>=60 then
		if DW_EliteSkill_CheckProgress(Main_Voc,Sub_Voc)~=10000 then
			ScriptMessage( Player, Player, 2, "[SC_111454_9]", 0 )--恭喜你！你學到新的技能！
			for Lv=15,50,5 do
				DW_EliteSkill_Get(Lv,true);
			end
		end
		return true;
	else
		return false;
	end
end
--新世界的每10等得到精英技能的規則
	
function Lua_Across10Lv_CheckLv(MainVoc,SubVoc)
	local Player=OwnerID();
	local MainLv=voc_lv(MainVoc,Player);
	local SubLv=voc_lv(SubVoc,Player);
	local TopLv=70;
	for Lv=60,TopLv,10 do--等距為10
		if MainLv<Lv or SubLv<Lv then
			return Lv;
		end
	end
	return 10000;--回傳一個超大值 代表等級俱滿
end
function Lua_Across10Lv_CheckKeyItem(MainVoc,SubVoc)
	local Player=OwnerID();
	local TopLv=70;
	local KeyItemID;
	for Lv=60,TopLv,10 do
		KeyItemID=Lua_Across10Lv_KeyItemSearch(Lv,MainVoc,SubVoc);
		if CheckFlag(Player,KeyItemID)==false then
			return Lv;--回傳還不會的KeyItem;
		end
	end
	return 10000;--回傳一個超大值 代表已經學完全部
end
function Lua_Across10Lv_AddCond_1()--追加判斷條件2:已經學過任何60+的菁英技能
	local player=OwnerID();
	local ownVOC={};
	for voc=1,10,1 do--目前最多十種職業
		local lv=voc_lv(voc,player);
		if(lv>0)then
			table.insert(ownVOC,voc);
		end
	end
	for i=1,#ownVOC,1 do
		for j=1,#ownVOC,1 do
			if(i~=j)then
				local KeyItemID=Lua_Across10Lv_KeyItemSearch(60,ownVOC[i],ownVOC[j]);--只判斷60級
				if(CheckFlag(player,KeyItemID)==true)then--曾經學過即可
					return true;
				end
			end
		end
	end
	return false;
end
function Lua_Across10Lv_KeyItemSearch(Lv,MainVoc,SubVoc)
	--最低為60，視為1
	local LvScale = (Lv/10)-5;
	local KeyItemList = {

				[1]={
					[2]={546730,546731},
					[3]={546732,546733},
					[4]={546734,546735},
					[5]={546736,546737},
					[6]={546738,546739},
					[7]={546740,546741},
					[8]={546742,546743},
					[9]={546744,546745},
					[10]={546746,546747}
				},


				[2]={
					[1]={546748,546749},
					[3]={546750,546751},
					[4]={546752,546753},
					[5]={546754,546755},
					[6]={546756,546757},
					[7]={546758,546759},
					[8]={546760,546761}
				},

				[3]={
					[1]={546762,546763},
					[2]={546764,546765},
					[4]={546766,546767},
					[5]={546768,546769},
					[6]={546770,546771},
					[7]={546772,546773},
					[8]={546774,546775},
					[9]={546776,546777},
					[10]={546778,546779}
				},

				[4] = {
					[1]={546780,546781},
					[2]={546782,546783},
					[3]={546784,546785},
					[5] ={546786,546787},
					[6]={546788,546789},
					[7]={546790,546791},
					[8]={546792,546793},
					[9]={546794,546796},
					[10]={546797,546798}
				},
				[5] = {
					[1]={546799,546800},
					[2]={546801,546802},
					[3]={546803,546804},
					[4]={546805,546806},
					[6]={546807,546808},
					[9]={546809,546810},
					[10]={546811,546812}
				},


				[6]={
					[1]={546813,546814},
					[2]={546815,546816},
					[3]={546817,546818},
					[4]={546819,546820},
					[5]={546821,546822}
				},

				[7]={
					[1]={546823,546824},
					[2]={546825,546826},
					[3]={546827,546828},
					[4]={546829,546830},
					[8]={546831,546832}
				},


				[8]={
					[1]={546833,546834},
					[2]={546835,546836},
					[3]={546837,546838},
					[4]={546839,546840},
					[7]={546841,546842}
				},

				[9]={
					[1]={546843,546844},
					[3]={546845,546846},
					[4]={546847,546848},
					[5]={546849,546850},
					[10]={546851,546852}
				},


				[10]={
					[1]={546853,546854},
					[3]={546855,546856},
					[4]={546857,546858},
					[5]={546859,546860},
					[9]={546861,546862}
				}
									};
	------140310 K.J. Aris
	if ( KeyItemList[MainVoc] ~= nil ) and 
	   ( KeyItemList[MainVoc][SubVoc] ~= nil ) and
	   ( KeyItemList[MainVoc][SubVoc][LvScale] ~= nil ) then
		return KeyItemList[MainVoc][SubVoc][LvScale];
	else
		return 0;
	end
	------140310 K.J. Aris

	--return KeyItemList[MainVoc][SubVoc][LvScale];--140310 Mark up

end
function Lua_Across10Lv_GetKeyItem(Lv)
	local Player = OwnerID()
	local MainVoc = ReadRoleValue(Player,EM_RoleValue_VOC)
	local SubVoc = ReadRoleValue(Player,EM_RoleValue_VOC_SUB)

	local KeyItemID = Lua_Across10Lv_KeyItemSearch(Lv,MainVoc,SubVoc)
	SetFlag(Player,KeyItemID,1) --開啟技能

	KeyItemID = Lua_Across10Lv_KeyItemSearch(Lv,SubVoc,MainVoc)--同時取得另一邊的技能
	SetFlag(Player,KeyItemID,1) --開啟技能
end